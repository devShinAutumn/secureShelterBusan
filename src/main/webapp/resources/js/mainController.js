var chartColor = [0, 0x9B9C99, 0x6E6F6D, 0x353535, 0xD458FF, 0xA949CB, 0xA926D7, 0xD24597, 0xBD227B, 0xA70863, 0xED9B9F, 0xF86668, 0xFF0000, 0xFFAD4D, 0xF58400, 0xCC6E00, 0xBCBD22, 0xB3B502, 0x8D8E00, 0x04E9AC, 0x00C994, 0x009987, 0x87D5E0, 0x42E8FF, 0x24B9CD, 0x75C5FF, 0x0094FF, 0x0076CC, 0xFFDE2F, 0xEFC900, 0xC8A800,0x3468A5],
    chartWarningColor = ["0x00FF7F","0xFFFF00","0xB22222","0x1C1C1C"],
    chartWarningSize = [60,30,20,15],
    busan = {
        "type":"FeatureCollection",
        "features":
        [
            {
                "type": "Feature",
                "geometry": {
                    "type": "MultiPolygon",
                    "coordinates": [
                        [
                            [
                                [
                                    129.2783,
                                    35.324
                                ],
                                [
                                    129.2688,
                                    35.3213
                                ],
                                [
                                    129.2585,
                                    35.3057
                                ],
                                [
                                    129.2618,
                                    35.2946
                                ],
                                [
                                    129.2535,
                                    35.271
                                ],
                                [
                                    129.2443,
                                    35.2715
                                ],
                                [
                                    129.2432,
                                    35.2635
                                ],
                                [
                                    129.2535,
                                    35.2565
                                ],
                                [
                                    129.254,
                                    35.2465
                                ],
                                [
                                    129.2413,
                                    35.2263
                                ],
                                [
                                    129.2224,
                                    35.2124
                                ],
                                [
                                    129.2307,
                                    35.2004
                                ],
                                [
                                    129.2251,
                                    35.1963
                                ],
                                [
                                    129.2249,
                                    35.1854
                                ],
                                [
                                    129.2163,
                                    35.1871
                                ],
                                [
                                    129.2107,
                                    35.1807
                                ],
                                [
                                    129.2001,
                                    35.1796
                                ],
                                [
                                    129.194,
                                    35.1604
                                ],
                                [
                                    129.1821,
                                    35.1543
                                ],
                                [
                                    129.1693,
                                    35.1593
                                ],
                                [
                                    129.1582,
                                    35.1588
                                ],
                                [
                                    129.1529,
                                    35.1515
                                ],
                                [
                                    129.1429,
                                    35.154
                                ],
                                [
                                    129.1218,
                                    35.1546
                                ],
                                [
                                    129.1174,
                                    35.1521
                                ],
                                [
                                    129.1179,
                                    35.1399
                                ],
                                [
                                    129.1288,
                                    35.1143
                                ],
                                [
                                    129.1232,
                                    35.0971
                                ],
                                [
                                    129.1135,
                                    35.1024
                                ],
                                [
                                    129.1029,
                                    35.0979
                                ],
                                [
                                    129.0899,
                                    35.1029
                                ],
                                [
                                    129.0762,
                                    35.1024
                                ],
                                [
                                    129.0671,
                                    35.1074
                                ],
                                [
                                    129.0715,
                                    35.1224
                                ],
                                [
                                    129.064,
                                    35.1262
                                ],
                                [
                                    129.0579,
                                    35.1193
                                ],
                                [
                                    129.0451,
                                    35.1149
                                ],
                                [
                                    129.0443,
                                    35.1065
                                ],
                                [
                                    129.0271,
                                    35.0915
                                ],
                                [
                                    129.0249,
                                    35.076
                                ],
                                [
                                    129.0163,
                                    35.0751
                                ],
                                [
                                    129.0207,
                                    35.0646
                                ],
                                [
                                    129.011,
                                    35.0643
                                ],
                                [
                                    129.0035,
                                    35.081
                                ],
                                [
                                    128.9929,
                                    35.0821
                                ],
                                [
                                    128.9971,
                                    35.0607
                                ],
                                [
                                    129.0026,
                                    35.0485
                                ],
                                [
                                    128.9926,
                                    35.0449
                                ],
                                [
                                    128.991,
                                    35.0576
                                ],
                                [
                                    128.9807,
                                    35.0607
                                ],
                                [
                                    128.9671,
                                    35.0432
                                ],
                                [
                                    128.9588,
                                    35.0507
                                ],
                                [
                                    128.9501,
                                    35.0796
                                ],
                                [
                                    128.9546,
                                    35.0924
                                ],
                                [
                                    128.956,
                                    35.106
                                ],
                                [
                                    128.9499,
                                    35.1065
                                ],
                                [
                                    128.9462,
                                    35.0915
                                ],
                                [
                                    128.934,
                                    35.0849
                                ],
                                [
                                    128.926,
                                    35.0924
                                ],
                                [
                                    128.9146,
                                    35.0885
                                ],
                                [
                                    128.9124,
                                    35.0785
                                ],
                                [
                                    128.8949,
                                    35.0785
                                ],
                                [
                                    128.9001,
                                    35.1029
                                ],
                                [
                                    128.9001,
                                    35.1115
                                ],
                                [
                                    128.9057,
                                    35.1179
                                ],
                                [
                                    128.8946,
                                    35.1212
                                ],
                                [
                                    128.8896,
                                    35.1082
                                ],
                                [
                                    128.8885,
                                    35.089
                                ],
                                [
                                    128.8843,
                                    35.0785
                                ],
                                [
                                    128.8685,
                                    35.0829
                                ],
                                [
                                    128.8374,
                                    35.0829
                                ],
                                [
                                    128.8354,
                                    35.0876
                                ],
                                [
                                    128.819,
                                    35.091
                                ],
                                [
                                    128.8026,
                                    35.0896
                                ],
                                [
                                    128.7954,
                                    35.0801
                                ],
                                [
                                    128.7821,
                                    35.0826
                                ],
                                [
                                    128.7935,
                                    35.0979
                                ],
                                [
                                    128.7885,
                                    35.106
                                ],
                                [
                                    128.7918,
                                    35.1178
                                ],
                                [
                                    128.7939,
                                    35.1219
                                ],
                                [
                                    128.8197,
                                    35.1306
                                ],
                                [
                                    128.8651,
                                    35.1406
                                ],
                                [
                                    128.8666,
                                    35.1717
                                ],
                                [
                                    128.8696,
                                    35.1841
                                ],
                                [
                                    128.8939,
                                    35.1866
                                ],
                                [
                                    128.9348,
                                    35.2077
                                ],
                                [
                                    128.9787,
                                    35.2089
                                ],
                                [
                                    128.9938,
                                    35.2226
                                ],
                                [
                                    129.0029,
                                    35.24
                                ],
                                [
                                    129.0217,
                                    35.2518
                                ],
                                [
                                    129.0358,
                                    35.2578
                                ],
                                [
                                    129.0473,
                                    35.266
                                ],
                                [
                                    129.0635,
                                    35.2734
                                ],
                                [
                                    129.0829,
                                    35.2706
                                ],
                                [
                                    129.0938,
                                    35.2823
                                ],
                                [
                                    129.1029,
                                    35.3058
                                ],
                                [
                                    129.121,
                                    35.3282
                                ],
                                [
                                    129.1483,
                                    35.3319
                                ],
                                [
                                    129.1725,
                                    35.3332
                                ],
                                [
                                    129.1786,
                                    35.3493
                                ],
                                [
                                    129.1983,
                                    35.3667
                                ],
                                [
                                    129.2098,
                                    35.3728
                                ],
                                [
                                    129.2132,
                                    35.3632
                                ],
                                [
                                    129.2552,
                                    35.3632
                                ],
                                [
                                    129.2694,
                                    35.3516
                                ],
                                [
                                    129.28,
                                    35.3371
                                ],
                                [
                                    129.2783,
                                    35.324
                                ]
                            ]
                        ],
                        [
                            [
                                [
                                    129.0593,
                                    35.1018
                                ],
                                [
                                    129.079,
                                    35.0879
                                ],
                                [
                                    129.076,
                                    35.0737
                                ],
                                [
                                    129.0871,
                                    35.0637
                                ],
                                [
                                    129.0965,
                                    35.0596
                                ],
                                [
                                    129.0912,
                                    35.0501
                                ],
                                [
                                    129.0818,
                                    35.0501
                                ],
                                [
                                    129.0785,
                                    35.059
                                ],
                                [
                                    129.0701,
                                    35.0582
                                ],
                                [
                                    129.064,
                                    35.0693
                                ],
                                [
                                    129.0501,
                                    35.0729
                                ],
                                [
                                    129.0382,
                                    35.081
                                ],
                                [
                                    129.031,
                                    35.0893
                                ],
                                [
                                    129.0399,
                                    35.0979
                                ],
                                [
                                    129.0593,
                                    35.1018
                                ]
                            ]
                        ]
                    ]
                },
                "properties": {
                    "name": "부산",
                    "id": "KR-26",
                    "TYPE": "Metropolitan City",
                    "CNTRY": "South Korea"
                },
                "id": "KR-26"
            },
        ]
};

function getMainDashBoard() {
    getSsbExpect();
    getGraphLineData();
    getGraphMapData();
    getGraphCloudData();
}

function getSsbExpect() {
    $.ajax({
        url: '/ssbExpect',
        type: 'GET',
        beforeSend: function () {
            $('#totalRate').text('-');
            $('#earthquakeRate').text('-');
            $('#mountainRate').text('-');
            $('#sinkhallRate').text('-');
            $('#shoreRate').text('-');
        },
        success: function (data) {
            $('#totalRate').text(data.totalRate+"%");
            $('#earthquakeRate').text(data.earthquakeRate+"%");
            $('#shoreRate').text(data.shoreRate+"%");
            $('#mountainRate').text(data.mountainRate+"%");
            $('#sinkhallRate').text(data.sinkhallRate+"%");
            $('#earthquakeRate').addClass(graphColorSelecter(data.earthquakeRate));
            $('#shoreRate').addClass(graphColorSelecter(data.shoreRate));
            $('#mountainRate').addClass(graphColorSelecter(data.mountainRate));
            $('#sinkhallRate').addClass(graphColorSelecter(data.sinkhallRate));

            $('#earthquakeRateBar').css('width',parseInt(data.earthquakeRate)+10+"%");
            $('#shoreRateBar').css('width',parseInt(data.shoreRate)+10+"%");
            $('#mountainRateBar').css('width',parseInt(data.mountainRate)+10+"%");
            $('#sinkhallRateBar').css('width',parseInt(data.sinkhallRate)+10+"%");
            $('#earthquakeRateBar').addClass(graphColorSelecter(data.earthquakeRate));
            $('#shoreRateBar').addClass(graphColorSelecter(data.shoreRate));
            $('#mountainRateBar').addClass(graphColorSelecter(data.mountainRate));
            $('#sinkhallRateBar').addClass(graphColorSelecter(data.sinkhallRate));

            var reqData = [
                {"name": "Earthquake","value" : parseFloat(data.earthquakeRate)},
                {"name": "Tsunami","value" : parseFloat(data.shoreRate)},
                {"name": "Landslide","value" : parseFloat(data.mountainRate)},
                {"name": "Typhoon","value" : parseFloat(data.sinkhallRate)},
            ];

            createPieGraph(reqData, "overallRisk" , parseFloat(data.totalRate))
        },
    });
}
function graphColorSelecter(num){

    var numColor = '';
    if(num <= 1){
        numColor = 'C1'
    }else if (num <= 5){
        numColor = 'C2'
    }else if (num <= 10){
        numColor = 'C3'
    }else{
        numColor = 'C4'
    }
    return numColor;
}

function getGraphLineData() {
    $.ajax({
        url: '/graph/line',
        type: 'GET',
        success: function (data) {
            const ripCrntList = data['ripCrntList'],
                  tidalObservList = data['tidalObservList'],
                  obsAsosTimList = data['obsAsosTimList'];

            let ripCrntData = [],
                windDirData = [],
                windSpeedData = [],
                airTempData = [],
                airPressData = [],
                tidLevelData = [],
                obsAsosTimData = [];

            for (let i = 0, j = ripCrntList.length; i < j; i++) {
                ripCrntData.push({
                    "date" : new Date(ripCrntList[i].obsTime).getTime(),
                    "value": parseFloat(ripCrntList[i].waveHeight),
                    "value2": parseFloat(ripCrntList[i].airTemp),
                });
            }
            createLineGraph(ripCrntData, "ripCrntGraph", "wave height", 21);

            for (let i = 0, j = tidalObservList.length; i < j; i++) {
                windDirData.push({
                    "date" : new Date(tidalObservList[i].recordTime).getTime(),
                    "value": parseFloat(tidalObservList[i].windGust),
                    "name": "squall"
                });
                windSpeedData.push({
                    "date" : new Date(tidalObservList[i].recordTime).getTime(),
                    "value": parseFloat(tidalObservList[i].windSpeed),
                    "name": "wind speed"
                });
                airTempData.push({
                    "date" : new Date(tidalObservList[i].recordTime).getTime(),
                    "value": parseFloat(tidalObservList[i].airTemp),
                    "name": "temperatures"
                });
                airPressData.push({
                    "date" : new Date(tidalObservList[i].recordTime).getTime(),
                    "value": parseFloat(tidalObservList[i].airPress),
                    "name": "atmospheric pressure"
                });
                tidLevelData.push({
                    "date" : new Date(tidalObservList[i].recordTime).getTime(),
                    "value": parseFloat(tidalObservList[i].tideLevel),
                    "name": "condolence"
                })
            }
            for (let i = 0, j = obsAsosTimList.length; i < j; i++) {
                obsAsosTimData.push({
                    "date": new Date(obsAsosTimList[i].time).getTime(),
                    "value" : parseFloat(obsAsosTimList[i].mm),
                    "name": "precipitation"
                })
            }
            createLineGraph2([windDirData, windSpeedData],"tidalObserv1","풍향/풍속" , 17);
            createLineGraph2([airPressData, airTempData], "tidalObserv2","기온/기압",  14);
            createLineGraph2([tidLevelData], "tidalObserv3","조위",  23, true);
            createLineGraph(obsAsosTimData, "tidalObserv4", "강수량", 22, true);
        },
    });
}
function getGraphMapData() {
    $.ajax({
        url: '/graph/map',
        type: 'GET',
        success: function (data) {
            let ssbShelterData = [],
                livingPopulation = [];

            for (let i = 0, j = data['ssbShelterData'].length; i < j; i++) {
                var value = (parseFloat(data['ssbShelterData'][i].population) / data['ssbShelterData'][i].shelAv) * 100,
                    color = 0;

                if (value <= 20) color = 0;
                else if (value <= 40) color = 1;
                else if (value <= 60) color = 2;
                else color = color = 3;


                ssbShelterData.push({
                    remarks: data['ssbShelterData'][i].remarks,
                    address: data['ssbShelterData'][i].address,
                    shelAv: parseInt(data['ssbShelterData'][i].shelAv),
                    tel: data['ssbShelterData'][i].tel,
                    long: parseFloat(data['ssbShelterData'][i].lon),
                    lat: parseFloat(data['ssbShelterData'][i].lat),
                    value : color,
                    fill: chartWarningColor[color],
                });
            }
            createMapGraph(ssbShelterData, livingPopulation);
        },
    });
}
function createLineGraph(data, id, chartNm, colorIndex, type) {
    am5.ready(function() {
        am5.addLicense("AM5C328946569");
        class MyTheme extends am5.Theme {
            setupDefaultRules() {
                this.rule("Label").setAll({
                    fontSize: 12,
                });
            }
        }
        var root = am5.Root.new(id);
        root.setThemes([
            am5themes_Animated.new(root),
            MyTheme.new(root)
        ]);
        var chart = root.container.children.push(
            am5xy.XYChart.new(root, {
                layout: root.verticalLayout,
                arrangeTooltips: false,
            }));
        chart.get("colors").set("colors", [
            am5.color(chartColor[colorIndex])
        ]);
        var xRenderer = '',
            yRenderer = '';

        xRenderer = am5xy.AxisRendererX.new(root, {
                strokeOpacity: 1,
                stroke: am5.color(0xDEE5EE), //X axis main-line
                strokeWidth: 1,
        });
        xRenderer.grid.template.set("location", 0.5);
        xRenderer.labels.template.setAll({
            location: 0.5,
            multiLocation: 0.5
        });
        xRenderer.labels.template.setAll({
            fontSize: 12,
            inside: false,
            paddingTop:6,
        });
        xRenderer.grid.template.setAll({
            location: 0.5,
            stroke: am5.color(0xDEE5EE),
            strokeWidth: 1,
            strokeOpacity: 1,
        });
        var xAxis = '';

        if (type) {
            xAxis = chart.xAxes.push(
                am5xy.DateAxis.new(root, {
                    groupData: true,
                    baseInterval: {timeUnit: "hour", count: 1},
                    renderer: xRenderer,
                    tooltipDateFormat: 'yyyy-MM-dd',
                    tooltip: am5.Tooltip.new(root, {
                        fontSize: 12,
                    }),
                })
            );
            xAxis.get("dateFormats")["hour"] = 'MM.dd HH:mm:ss';
            xAxis.get("periodChangeDateFormats")["hour"] = 'MM.dd HH:mm';
        } else {
            xAxis = chart.xAxes.push(
                am5xy.DateAxis.new(root, {
                    groupData: true,
                    baseInterval: {timeUnit: "day", count: 1},
                    renderer: xRenderer,
                    tooltipDateFormat: 'yyyy-MM-dd',
                    tooltip: am5.Tooltip.new(root, {
                        fontSize: 12,
                    }),
                })
            );
            xAxis.get("dateFormats")["day"] = 'yyyy-MM-dd';
            xAxis.get("dateFormats")["week"] = 'yyyy-MM-dd';
            xAxis.get("dateFormats")["month"] = 'yyyy-MM';
            xAxis.get("dateFormats")["year"] = 'yyyy-MM';
            xAxis.get("periodChangeDateFormats")["day"] = 'yyyy-MM-dd';
            xAxis.get("periodChangeDateFormats")["week"] = 'yyyy-MM-dd';
            xAxis.get("periodChangeDateFormats")["month"] = 'yyyy-MM';
            xAxis.get("periodChangeDateFormats")["year"] = 'yyyy-MM';
        }

        xAxis.data.setAll(data);

        yRenderer = am5xy.AxisRendererY.new(root, {
            inversed: false,
            strokeOpacity: 1,
            stroke: am5.color(0xDEE5EE), //Yaxis main-line
            strokeWidth: 1,
        });
        yRenderer.grid.template.setAll({
            stroke: am5.color(0xDEE5EE),
            strokeWidth: 1,
            strokeOpacity: 0,
            opacity: 0,
        });
        yRenderer.labels.template.setAll({
            minPosition: 0.1,
            fontSize: 12,
            inside: false,
            paddingRight:6,
            //paddingBottom:10,
            opacity: 0,
        });
        var yAxis = chart.yAxes.push(
            am5xy.ValueAxis.new(root, {
                maxPrecision: 0,
                renderer: yRenderer,

            })
        );
        function createRange2(value1,value2,label) {
            let rangeContract = xAxis.makeDataItem({
                value : value1,
                endValue: value2,
                above: true,
            });
            let contractDate = xAxis.createAxisRange(rangeContract);
            contractDate.get("grid").setAll({
                stroke: am5.color(0x0094FF),
                strokeOpacity: 1,
                strokeWidth: 2,
                strokeDasharray: [5, 3]
            });
            contractDate.get("label").setAll({
                above: true,
                text: label,
                location: 0,
                fontSize: 12,
                inside: true,
                rotation: 0,
                centerX: am5.p50,
                centerY: am5.p100,
                paddingTop: 6,
                paddingBottom: 6,
                paddingRight: 8,
                paddingLeft:8,
                dy: -220,
                fill: am5.color(0xFFFFFF),
                background: am5.RoundedRectangle.new(root, {
                    fill: am5.color(0x0094FF),
                    shadowColor: am5.color(0x000000),
                    shadowBlur: 5,
                    shadowOffsetX: 0,
                    shadowOffsetY: 5,
                    shadowOpacity: 0.32,
                })
            });
        }
        function createSeries(name) {
            var series = chart.series.push(am5xy.LineSeries.new(root, {
                xAxis: xAxis,
                yAxis: yAxis,
                name: name,
                valueYField: "value",
                valueXField: "date",
                maskBullets: false,
                stroke: am5.color(chartColor[colorIndex]),
                tooltip: am5.Tooltip.new(root, {}),
            }));
            series.strokes.template.setAll({
                strokeWidth: 3,
                above: true,
            });
            var tooltip = am5.Tooltip.new(root, {
                getFillFromSprite: false,
                getStrokeFromSprite: true,
                autoTextColor: false,
                getLabelFillFromSprite: false,
                pointerOrientation: "horizontal",
                labelText: "{name}: {valueY}",
                color: am5.color(0x000000),
                fill: am5.color(0xffffff),
                fillOpacity: 0.8,
                stroke: root.interfaceColors.get("background"),
                strokeWidth: 2,
            });

            tooltip.get("background").setAll({
                fill: am5.color(0xffffff),
                fillOpacity: 0.8,
                color: am5.color(0x000000),
                strokeWidth: 2,
            });
            tooltip.label.setAll({
                fill: am5.color(0x000000),
                fontSize:12,
            });

            series.bullets.push(function() {
                var circle = am5.Circle.new(root, {
                    radius: 5,
                    stroke: series.get("fill"),
                    strokeWidth: 3.5,
                    interactive: true,
                    fill: am5.color(0xffffff),
                    opacity: 0
                });
                circle.states.create("default", {
                    opacity: 0
                });
                circle.states.create("hover", {
                    opacity: 1
                });
                return am5.Bullet.new(root, {
                    sprite: circle
                });
            });
            series.set("tooltip", tooltip);
            series.data.setAll(data);
            return series;
        }
        // var series = createSeries(chartNm);
        var cursor = chart.set("cursor", am5xy.XYCursor.new(root, {
            xAxis: xAxis,
        }));
        cursor.lineY.set("visible", false);
        cursor.lineX.setAll({
            stroke: am5.color(0x202020),
            strokeWidth: 2,
            strokeDasharray: [5,4],
            strokeOpacity: 1,
        });

        var distanceAxisRenderer = am5xy.AxisRendererY.new(root, {});
        distanceAxisRenderer.grid.template.set("forceHidden", true);
        var distanceAxis = chart.yAxes.push(am5xy.ValueAxis.new(root, {
            renderer: distanceAxisRenderer,
            tooltip: am5.Tooltip.new(root, {})
        }));

        var distanceSeries = chart.series.push(am5xy.ColumnSeries.new(root, {
            xAxis: xAxis,
            yAxis: distanceAxis,
            valueYField: "value",
            valueXField: "date",
            tooltip:am5.Tooltip.new(root, {
                labelText:"{valueY}"
            })
        }));

        distanceSeries.data.processor = am5.DataProcessor.new(root, {
            dateFields: ["date"],
            dateFormat: "yyyy-MM-dd"
        });
        distanceSeries.data.setAll(data);

        // series.appear();
        distanceSeries.appear();
        chart.appear(1000, 100);

        var previousBulletSprites = [];
        cursor.events.on("cursormoved", cursorMoved);
        chart.events.on("pointerout", function () {
            for(var i = 0; i < previousBulletSprites.length; i++) {
                previousBulletSprites[i].unhover();
            }
        });
        function cursorMoved() {
            for(var i = 0; i < previousBulletSprites.length; i++) {
                previousBulletSprites[i].unhover();
            }
            previousBulletSprites = [];
            chart.series.each(function(series) {
                var dataItem = series.get("tooltip").dataItem;
                if (dataItem) {
                    var bulletSprite = dataItem.bullets[0].get("sprite");
                    bulletSprite.hover();
                    previousBulletSprites.push(bulletSprite);
                    // cursor.lineX.set("visible", true);
                    // series.get("xAxis").get("tooltip").set("visible", true);
                // } else {
                    // series.get("xAxis").get("tooltip").set("visible", false);
                    // cursor.lineX.set("visible", false);
                }
            });
        }
    });// end 원소재 공통 그래프
}
function createLineGraph2(data, id, chartNm, colorIndex, type) {
    am5.ready(function() {
        am5.addLicense("AM5C328946569");
        class MyTheme extends am5.Theme {
            setupDefaultRules() {
                this.rule("Label").setAll({
                    fontSize: 12,
                });
            }
        }
        var root = am5.Root.new(id);
        root.setThemes([
            am5themes_Animated.new(root),
            MyTheme.new(root)
        ]);
        var chart = root.container.children.push(
            am5xy.XYChart.new(root, {
                layout: root.verticalLayout,
                arrangeTooltips: false,
            }));
        chart.get("colors").set("colors", [
            am5.color(chartColor[colorIndex])
        ]);
        var xRenderer = '',
            yRenderer = '';

        xRenderer = am5xy.AxisRendererX.new(root, {
                maxGridDistance: 20,
                strokeOpacity: 1,
                stroke: am5.color(0xDEE5EE), //X axis main-line
                strokeWidth: 1,
        });
        xRenderer.grid.template.set("location", 0.5);
        xRenderer.labels.template.setAll({
            location: 0.5,
            multiLocation: 0.5
        });
        xRenderer.labels.template.setAll({
            fontSize: 12,
            inside: false,
            paddingTop:6,
        });
        xRenderer.grid.template.setAll({
            location: 0.5,
            stroke: am5.color(0xDEE5EE),
            strokeWidth: 1,
            strokeOpacity: 1,
        });
        var xAxis = chart.xAxes.push(
            am5xy.DateAxis.new(root,{
                baseInterval: { timeUnit: "hour", count: 1 },
                renderer: xRenderer,
                tooltipDateFormat: 'MM.dd HH:mm',
                tooltip: am5.Tooltip.new(root, {
                    fontSize:12,
                }),
                groupData: true,
            })
        );
        xAxis.get("dateFormats")["hour"] = 'MM.dd HH:mm';
        xAxis.get("periodChangeDateFormats")["hour"] = 'MM.dd HH:mm';
        xAxis.data.setAll(data);

        function createSeries(name,i) {
            var yRenderer = am5xy.AxisRendererY.new(root, {
                inversed: false,
                strokeOpacity: 0,
                stroke: am5.color(0xDEE5EE), //Yaxis main-line
                strokeWidth: 1,
            });
            yRenderer.grid.template.setAll({
                stroke: am5.color(0xDEE5EE),
                strokeWidth: 1,
                strokeOpacity: 0,
            });
            yRenderer.labels.template.setAll({
                fontSize: 0,
                paddingRight:0,
                opacity: 0,//y축 내용이 필요할때는 1로 변경,
                forceHidden: true

            });
            var yAxis = chart.yAxes.push(am5xy.ValueAxis.new(root, {
                renderer: yRenderer,
            }));
            if (chart.yAxes.indexOf(yAxis) > 0) {
                yAxis.set("syncWithAxis", chart.yAxes.getIndex(0));
            }

            var series = chart.series.push(am5xy.LineSeries.new(root, {
                xAxis: xAxis,
                yAxis: yAxis,
                name: name,
                valueYField: "value",
                valueXField: "date",
                maskBullets: false,
                stroke: am5.color(chartColor[colorIndex + i]),
                tooltip: am5.Tooltip.new(root, {}),
            }));
            series.strokes.template.setAll({
                strokeWidth: 3,
                above: true,
            });
            var tooltip = am5.Tooltip.new(root, {
                getFillFromSprite: false,
                getStrokeFromSprite: true,
                autoTextColor: false,
                getLabelFillFromSprite: false,
                pointerOrientation: "horizontal",
                labelText: "{name}: {valueY}",
                color: am5.color(0x000000),
                fill: am5.color(0xffffff),
                fillOpacity: 0.8,
                stroke: root.interfaceColors.get("background"),
                strokeWidth: 2,
            });

            tooltip.get("background").setAll({
                fill: am5.color(0xffffff),
                fillOpacity: 0.8,
                color: am5.color(0x000000),
                strokeWidth: 2,
            });
            tooltip.label.setAll({
                fill: am5.color(0x000000),
                fontSize:12,
            });

            series.bullets.push(function() {
                var circle = am5.Circle.new(root, {
                    radius: 5,
                    stroke: series.get("fill"),
                    strokeWidth: 3.5,
                    interactive: true,
                    fill: am5.color(0xffffff),
                    opacity: 0
                });
                circle.states.create("default", {
                    opacity: 0
                });
                circle.states.create("hover", {
                    opacity: 1
                });
                return am5.Bullet.new(root, {
                    sprite: circle
                });
            });
            series.set("tooltip", tooltip);
            series.data.setAll(data[i]);
            return series;
        }

        for (var i = 0; i < data.length; i++) {
            var series = createSeries(chartNm,i);
        }
        var cursor = chart.set("cursor", am5xy.XYCursor.new(root, {
            xAxis: xAxis,
        }));
        cursor.lineY.set("visible", false);
        cursor.lineX.setAll({
            stroke: am5.color(0x202020),
            strokeWidth: 2,
            strokeDasharray: [5,4],
            strokeOpacity: 1,
        });


        if (type) {
            series.bullets.push(function() {
                return am5.Bullet.new(root, {
                    sprite: am5.Circle.new(root, {
                        templateField: "bulletSettings",
                        radius: 5
                    })
                });
            });
            series.fills.template.setAll({
                visible: true,
                fillOpacity: 0.5,
                templateField: "fillSettings"
            });
        }


        series.appear();
        chart.appear(1000, 100);

        var previousBulletSprites = [];
        cursor.events.on("cursormoved", cursorMoved);
        chart.events.on("pointerout", function () {
            for(var i = 0; i < previousBulletSprites.length; i++) {
                previousBulletSprites[i].unhover();
            }
        });
        function cursorMoved() {
            for(var i = 0; i < previousBulletSprites.length; i++) {
                previousBulletSprites[i].unhover();
            }
            previousBulletSprites = [];
            chart.series.each(function(series) {
                var dataItem = series.get("tooltip").dataItem;
                if (dataItem) {
                    var bulletSprite = dataItem.bullets[0].get("sprite");
                    bulletSprite.hover();
                    previousBulletSprites.push(bulletSprite);
                }
            });
        }
    });// end 원소재 공통 그래프
}
function createPieGraph(data, id, value) {
    am5.ready(function () {
        am5.addLicense("AM5C328946569");
        var root = am5.Root.new(id);
        root.setThemes([
            am5themes_Animated.new(root),
        ]);
        var chart = root.container.children.push(
            am5percent.PieChart.new(root, {
                layout: root.horizontalLayout,
                innerRadius: am5.percent(70),
                x: am5.percent(0),
            })
        );

        var series = chart.series.push(
            am5percent.PieSeries.new(root, {
                valueField: "value",
                categoryField: "name",
                legendLabelText: "[{fill}]{value}%[/]",
                legendValueText: "{category}[/]",
            })
        );
        series.slices.template.set("toggleKey", "none"); //Disabling pull-out
        series.get("colors").set("colors", [
            am5.color(0xD83939),
            am5.color(0xE8964A),
            am5.color(0xBFCE53),
            am5.color(0x4DA260),
        ]);
        var label = series.children.push(am5.Label.new(root, {
            text: value + '%',
            fontSize: 24,
            fontWeight: 900,
            fill: am5.color(0x2EC147),
            centerX: am5.percent(50),
            centerY: am5.percent(50),
            populateText: true
        }));
        var tooltip = am5.Tooltip.new(root, {
            getFillFromSprite: false,
            getStrokeFromSprite: true,
            autoTextColor: false,
            getLabelFillFromSprite: false,

            pointerOrientation: "left",
            //labelText: "[bold]{category}[/]: [bold{fill}]{value}%[/]",
            labelText: "{category}: {value}%",
            color: am5.color(0x000000),
            fill: am5.color(0xffffff),
            fillOpacity: 0.8,
            stroke: root.interfaceColors.get("background"),
        });
        tooltip.get("background").setAll({
            fill: am5.color(0xffffff),
            fillOpacity: 0.8,
            stroke: root.interfaceColors.get("background"),
            strokeWidth: 2,
            color: am5.color(0x000000),
        });
        tooltip.label.setAll({
            fill: am5.color(0x000000),
            fontSize: 12,
        });
        series.labels.template.set("forceHidden", true);
        series.ticks.template.set("forceHidden", true);
        series.set("tooltip", tooltip);
        series.data.setAll(data);

        var legend = chart.children.push(am5.Legend.new(root, {
            centerY: am5.percent(50),
            y: am5.percent(50),
            x: am5.percent(45),
            layout: root.verticalLayout,
            clickTarget: "none"
        }));

        legend.markers.template.setAll({
            width: 12,
            height: 12,
        });
        legend.labels.template.setAll({
            fontSize: 14,
            textAlign: "right",
            width: 35,
            fontWeight: 500,
        })
        legend.valueLabels.template.setAll({
            width: 170,
            textAlign: "left",
            fontSize: 14,
            marginLeft: 10,
            oversizedBehavior: "wrap",
        });
        legend.markerRectangles.template.setAll({
            cornerRadiusTL: 10,
            cornerRadiusTR: 10,
            cornerRadiusBL: 10,
            cornerRadiusBR: 10,
            innerRadius: am5.percent(70),
            width: 10,
            height: 10,
        });
        legend.data.setAll(series.dataItems);
    });
}
function createMapGraph(ssbShelterData, livingPopulation) {
    am5.ready(function () {
        am5.addLicense("AM5C328946569");
        var root = am5.Root.new("mapGraph");
        root.setThemes([
            am5themes_Animated.new(root)
        ]);
        var chart = root.container.children.push(
            am5map.MapChart.new(root, {
                panX: "rotateX"
            })
        );
        var polygonSeries = chart.series.push(
                am5map.MapPolygonSeries.new(root, {
                    geoJSON: busan
                })
            ),
            pointSeries = chart.series.push(
                am5map.MapPointSeries.new(root, {
                    latitudeField: "lat",
                    longitudeField: "long"
                })
            );
        var circleTemplate = am5.Template.new({});
        circleTemplate.adapters.add("fill", function(fill, target) {
            var dataItem = target.dataItem;
            if (dataItem) {
                return am5.Color.fromString(dataItem.dataContext.fill);
            }
            return fill
        });
        circleTemplate.adapters.add("radius", function(fill, target) {
            var dataItem = target.dataItem;
            if (dataItem) {
                return am5.radius = chartWarningSize[parseFloat(dataItem.dataContext.value)];
            }
            return fill
        });
        pointSeries.bullets.push(function() {
            var circle = am5.Circle.new(root, {

                fillOpacity: 0.5,
                fill: pointSeries.get("fill"),
                tooltipText: "피난처: {remarks}\n주소: {address}\n연락처: {tel}",
            }, circleTemplate);
            return am5.Bullet.new(root, {
                sprite: circle
            });
        });

        pointSeries.bullets.push(function(root) {
            return am5.Bullet.new(root, {
                locationX: 0.5,
                locationY: 0.5,
                sprite: am5.Label.new(root, {
                    text: "{shelAv}",
                    centerX: am5.percent(50),
                    centerY: am5.percent(50),
                    populateText: true
                })
            });
        });
        pointSeries.set("heatRules", [{
            target: circleTemplate,
            min: 3,
            max: 60,
            dataField: "value",
            key: "radius"
        }]);
        pointSeries.data.setAll(ssbShelterData);
    });
}

function getGraphCloudData() {
    $.ajax({
        url: '/graph/getRhymeRhymeans',
        type: 'GET',
        success: function (data) {
            let fullVolume = [],
                lwrmdCloud = [];

            for (let i = 0, j = data['rhymeRhymeansData'].length; i < j; i++) {

                fullVolume.push({
                    "date" : new Date(data['rhymeRhymeansData'][i].rhymeDt).getTime(),
                    "value": parseInt(data['rhymeRhymeansData'][i].fullVolume),
                    "name": "total cloud"
                });
                lwrmdCloud.push({
                    "date" : new Date(data['rhymeRhymeansData'][i].rhymeDt).getTime(),
                    "value": parseInt(data['rhymeRhymeansData'][i].lwrmdCloud),
                    "name": "middle and lower clouds"
               })
            }
            createLineGraph2([fullVolume, lwrmdCloud], "rhymeRhymeansData", "운량", 21);
        }
    });
}